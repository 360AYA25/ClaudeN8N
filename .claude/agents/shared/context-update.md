# Протокол обновления контекста

> **Применяется:** Analyst agent
> **Когда:** После КАЖДОГО успешного build (enforce через hook)

## Когда обновлять

| Событие | Что обновить |
|---------|--------------|
| Успешный build | 2-INDEX.md (последние изменения) |
| Изменена критичная нода | ADR или Intent Card этой ноды |
| Новый инцидент | История в соответствующем ADR |
| Новый сервис добавлен | Создать Service Playbook |
| Новая критичная нода | Создать Node Intent Card |

## Что обновлять в INDEX

### Секция "Последние критичные изменения"

```markdown
| Версия | Изменение | Статус |
|--------|-----------|--------|
| v515 | Добавлена команда /water | ✅ Работает |  ← ДОБАВИТЬ
| v514 | Добавлен operation=sendMessage | ✅ Работает |
...
```

### Секция "Current State"

```markdown
**Последнее обновление:** 2025-12-15  ← ОБНОВИТЬ
**Версия workflow:** v515  ← ОБНОВИТЬ
```

## Что обновлять в ADR

### Если был инцидент:

Добавить в секцию "История инцидентов":

```markdown
### v515 (2025-12-15) - КРАТКОЕ ОПИСАНИЕ
- **Что сделали:** ...
- **Результат:** ❌/✅
- **Откат:** (если был)
- **Урок:** ...
```

### Если изменились правила:

Обновить секцию "DO NOT TOUCH" или "Правила изменений"

## Что обновлять в state.json

```json
{
  "workflow": {
    "version": 515,  // ← ОБНОВИТЬ
    "updated": "2025-12-15"  // ← ОБНОВИТЬ
  }
}
```

## Чеклист после обновления

- [ ] INDEX.md - версия обновлена?
- [ ] INDEX.md - последние изменения добавлены?
- [ ] ADR - история инцидентов (если был)?
- [ ] state.json - версия обновлена?
- [ ] Git commit с описанием?

# Ğ“Ğ›Ğ£Ğ‘ĞĞšĞ˜Ğ™ ĞĞĞĞ›Ğ˜Ğ— Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ« + Ğ˜ĞĞ¢Ğ•Ğ“Ğ Ğ˜Ğ ĞĞ’ĞĞĞĞ«Ğ™ ĞŸĞ›ĞĞ

> **Ğ”Ğ°Ñ‚Ğ°:** 2025-12-15
> **Ğ¦ĞµĞ»ÑŒ:** ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ 3 Ğ¿Ğ»Ğ°Ğ½Ğ° + Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ° + surgical edits
> **Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ğ½ĞµĞ´Ñ€ĞµĞ½Ğ¸ĞµĞ¼

---

## EXECUTIVE SUMMARY

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° (ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ°Ñ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°):
ĞĞ³ĞµĞ½Ñ‚Ñ‹ Ñ‚ĞµÑ€ÑÑÑ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¸ Ğ»Ğ¾Ğ¼Ğ°ÑÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‰Ğ¸Ğµ Ñ‡Ğ°ÑÑ‚Ğ¸ workflow Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾:
1. **Ğ’Ğ¸Ğ´ÑÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ°ĞºÑ‚Ğ¸ĞºÑƒ** (JSON Ğ½Ğ¾Ğ´Ñ‹), Ğ½Ğµ Ğ²Ğ¸Ğ´ÑÑ‚ **ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ** (Ğ·Ğ°Ñ‡ĞµĞ¼) Ğ¸ **Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñƒ** (Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ Ñ‚Ğ°Ğº)
2. **ĞĞµÑ‚ ÑÑ€ĞµĞ´Ğ½ĞµĞ³Ğ¾ ÑĞ»Ğ¾Ñ** - Service Playbooks Ğ¸ Node Intent Cards
3. **ĞĞµÑ‚ Change Protocol** - Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹ Ğ¼ĞµĞ½ÑÑÑ‚ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ, Ğ±ĞµĞ· Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ diff
4. **Ğ¢Ñ€Ğ°Ñ‚ÑÑ‚ 61,500 tokens** Ğ½Ğ° Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ñƒ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° (JSON Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ² Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹)
5. **Agent Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹ Ñ€Ğ°Ğ·Ğ´ÑƒÑ‚Ñ‹** - 21,500 tokens Ñ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼

### Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ (Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ):
**4-Ñ„Ğ°Ğ·Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½ Ğ½Ğ° 5 Ñ‡Ğ°ÑĞ¾Ğ²:**
1. **Agent Cleanup** (2Ñ‡) - file-based context + shared files â†’ ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ 67% tokens
2. **Context Architecture** (1.5Ñ‡) - 3 ÑƒÑ€Ğ¾Ğ²Ğ½Ñ + Service Playbooks + Node Intent Cards
3. **Builder Change Protocol** (1Ñ‡) - surgical edits + diff + validation
4. **Protected Nodes** (30Ğ¼Ğ¸Ğ½) - Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ‚Ğ¾Ñ€Ñ‹ + DO NOT TOUCH

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
- âœ… ĞĞ³ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ÑÑ‚ Ğ—ĞĞ§Ğ•Ğœ (ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ)
- âœ… ĞĞ³ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ÑÑ‚ ĞŸĞĞ§Ğ•ĞœĞ£ (ADRs + Node Intent Cards)
- âœ… Builder Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ»Ğ¾Ğ¼Ğ°Ñ‚ÑŒ (Change Protocol + validators)
- âœ… Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ 65% tokens (61,500 â†’ 21,400)
- âœ… Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ² 11 Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 250

---

## Ğ§ĞĞ¡Ğ¢Ğ¬ 1: Ğ’Ğ—ĞĞ˜ĞœĞĞĞ¢ĞĞĞ¨Ğ•ĞĞ˜Ğ¯ ĞĞ“Ğ•ĞĞ¢ĞĞ’ (ĞšĞĞš Ğ ĞĞ‘ĞĞ¢ĞĞ•Ğ¢ Ğ¡Ğ•Ğ™Ğ§ĞĞ¡)

### Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (v3.6.0):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ORCHESTRATOR                           â”‚
â”‚  âŒ NO MCP tools (pure router)                             â”‚
â”‚  âœ… ONLY: Read, Write, Task, Bash                          â”‚
â”‚  Role: Ğ”ĞµĞ»ĞµĞ³Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‡ĞµÑ€ĞµĞ· Task tool                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ARCHITECT     â”‚              â”‚   RESEARCHER    â”‚
â”‚  Model: sonnet  â”‚              â”‚  Model: sonnet  â”‚
â”‚  NO MCP tools   â”‚              â”‚  MCP: search_*  â”‚
â”‚  Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ñ User  â”‚              â”‚  get_*, list_*  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                               â†“
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“               â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BUILDER    â”‚  â”‚     QA       â”‚  â”‚   ANALYST    â”‚
â”‚  Model: OPUS â”‚  â”‚ Model: sonnetâ”‚  â”‚ Model: sonnetâ”‚
â”‚  MCP: create â”‚  â”‚ MCP: validateâ”‚  â”‚ MCP: get_*   â”‚
â”‚  update, fix â”‚  â”‚ test, triggerâ”‚  â”‚ executions   â”‚
â”‚  ONLY writer â”‚  â”‚ NO mutations â”‚  â”‚ Read-only    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5-Phase Flow:

```
PHASE 1: CLARIFICATION
User â†’ Architect (Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³) â†’ requirements

PHASE 2: RESEARCH
Architect â†’ Orchestrator â†’ Researcher
Researcher: search local â†’ existing â†’ templates â†’ nodes
Output: research_findings (fit_score, sources)

PHASE 3: DECISION + CREDENTIALS
Researcher â†’ Orchestrator â†’ Architect
Architect â†â†’ User (Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ°)
Orchestrator â†’ Researcher (discover credentials)
Architect â†â†’ User (select credentials)
Output: decision + blueprint + credentials_selected

PHASE 4: IMPLEMENTATION
Architect â†’ Orchestrator â†’ Researcher (deep dive)
Researcher: LEARNINGS â†’ patterns â†’ node configs
Output: build_guidance (gotchas, configs, warnings)

PHASE 5: BUILD + QA LOOP
Researcher â†’ Orchestrator â†’ Builder
Builder: create/update workflow
Orchestrator â†’ QA
QA: validate + test

IF QA FAIL:
  â”œâ”€â”€ Cycle 1-3: Builder fixes directly
  â”œâ”€â”€ Cycle 4-5: Researcher helps (alternative approach)
  â”œâ”€â”€ Cycle 6-7: Analyst diagnoses (root cause)
  â””â”€â”€ Cycle 8+: BLOCKED â†’ report to user

IF QA PASS:
  â†’ stage=complete
```

### Validation Gates (6 Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ…):

| Gate | ĞšĞ¾Ğ³Ğ´Ğ° | Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ | Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ ĞµÑĞ»Ğ¸ |
|------|-------|---------------|----------------|
| **GATE 0** | Before first Builder | Mandatory Research | build_guidance Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ |
| **GATE 1** | Cycles 1-7 | Progressive Escalation | Cycle 8+ (hard cap) |
| **GATE 2** | Before fix attempts | Execution Analysis | execution_analysis.completed = false |
| **GATE 3** | Before accepting PASS | Phase 5 Real Testing | phase_5_executed = false |
| **GATE 4** | Before web search | Knowledge Base First | LEARNINGS Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ñ‹ |
| **GATE 5** | After Builder | MCP = Source of Truth | mcp_calls array Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ |

---

## Ğ§ĞĞ¡Ğ¢Ğ¬ 2: ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ« (Ğ§Ğ¢Ğ ĞĞ• Ğ¢ĞĞš)

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° 1: ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ñ‚ĞµÑ€ÑĞµÑ‚ÑÑ

**Ğ¡Ğ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹:**
- Builder Ğ² v516 Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ v432 (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ jsonBody ÑĞ½Ğ¾Ğ²Ğ°)
- Builder ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ Memory node â†’ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ñ‚ĞµÑ€ÑÑÑ‚ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ
- Builder Ğ¼ĞµĞ½ÑĞµÑ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ² Switch â†’ Ğ·Ğ°Ğ±Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ BotFather

**ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ°Ñ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:**
ĞĞ³ĞµĞ½Ñ‚Ñ‹ Ğ²Ğ¸Ğ´ÑÑ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ‚Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ (JSON Ğ½Ğ¾Ğ´Ñ‹), Ğ½Ğ¾ ĞĞ• Ğ²Ğ¸Ğ´ÑÑ‚:
- **Ğ—ĞĞ§Ğ•Ğœ** Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ (ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ)
- **ĞŸĞĞ§Ğ•ĞœĞ£** Ğ½Ğ¾Ğ´Ğ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ° Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ñ‚Ğ°Ğº (Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ)
- **Ğ§Ğ¢Ğ** Ğ½ĞµĞ»ÑŒĞ·Ñ Ñ‚Ñ€Ğ¾Ğ³Ğ°Ñ‚ÑŒ (ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¸Ğ½Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹)

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```
Builder Ğ²Ğ¸Ğ´Ğ¸Ñ‚:
{
  "nodes": [
    {"id": "AI Agent", "type": "ai-agent"},
    {"id": "Memory", "type": "memory"}
  ]
}

Builder ĞĞ• Ğ²Ğ¸Ğ´Ğ¸Ñ‚:
- Ğ—ĞĞ§Ğ•Ğœ Memory: Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ³Ğ¾Ğ²Ğ¾Ñ€ÑÑ‚ "Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ" â†’ AI Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ÑŒ
- ĞŸĞĞ§Ğ•ĞœĞ£ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ: Memory Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ±Ñ‹Ñ‚ÑŒ ĞŸĞ•Ğ Ğ•Ğ” AI Agent
- Ğ§Ğ¢Ğ Ğ½ĞµĞ»ÑŒĞ·Ñ: customKey='telegram_user_id' ĞĞ•Ğ›Ğ¬Ğ—Ğ¯ Ğ¼ĞµĞ½ÑÑ‚ÑŒ (v442 ÑĞ»Ğ¾Ğ¼Ğ°Ğ»Ğ¸)
```

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° 2: Builder Ğ»Ğ¾Ğ¼Ğ°ĞµÑ‚ Ñ‚Ğ¾, Ñ‡Ñ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚

**Ğ¡Ğ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹:**
- ĞœĞµĞ½ÑĞµÑ‚ 1 Ğ½Ğ¾Ğ´Ñƒ â†’ Ğ»Ğ¾Ğ¼Ğ°ÑÑ‚ÑÑ 3 Ğ´Ñ€ÑƒĞ³Ğ¸Ñ…
- Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Ğ²ĞµÑÑŒ workflow (58 Ğ½Ğ¾Ğ´) â†’ Ğ¼ĞµĞ½ÑĞµÑ‚ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹
- ĞĞµÑ‚ diff â†’ Ğ½ĞµĞ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾ Ñ‡Ñ‚Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¾ÑÑŒ

**ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ°Ñ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:**
- ĞĞµÑ‚ Change Protocol (Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ master workflow)
- ĞĞµÑ‚ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ² (graph integrity, breaking changes)
- ĞĞµÑ‚ surgical edits (Builder Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ update_full Ğ²Ğ¼ĞµÑÑ‚Ğ¾ update_partial)

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```
User: "Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /water Ğ² Switch"

Builder Ğ´ĞµĞ»Ğ°ĞµÑ‚:
1. Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ²ĞµÑÑŒ workflow (58 Ğ½Ğ¾Ğ´, 58,000 tokens!)
2. ĞœĞµĞ½ÑĞµÑ‚ Switch node (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ /water)
3. Ğ¡Ğ›Ğ£Ğ§ĞĞ™ĞĞ Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ Ğ² Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ½Ğ¾Ğ´Ğµ (Ğ¾Ğ¿ĞµÑ‡Ğ°Ñ‚ĞºĞ° Ğ² JSON)
4. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ²ĞµÑÑŒ workflow Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾ (update_full)
5. Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: /water Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Ğ½Ğ¾ ÑĞ»Ğ¾Ğ¼Ğ°Ğ»Ğ°ÑÑŒ Ñ„Ğ¾Ñ‚Ğ¾-Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°

Ğ”Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ:
1. Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Switch node (100 tokens)
2. Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ diff: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ» 1 case Ğ² Switch
3. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚: Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ½Ğ¾Ğ´ Ğ½Ğµ Ñ‚Ñ€Ğ¾Ğ³Ğ°Ğ»
4. update_partial - Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ Switch node
5. Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: /water Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ½Ğµ Ñ‚Ñ€Ğ¾Ğ½ÑƒÑ‚Ğ¾
```

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° 3: Orchestrator Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ñ‚ 61,500 tokens

**Breakdown:**

| ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ | Tokens | ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ | Ğ˜Ñ‚Ğ¾Ğ³Ğ¾ |
|-----------|--------|------------|-------|
| orch.md | 10,000 | 1 | 10,000 |
| Agent role files | 2,500 | 5 Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² | 12,500 |
| run_state (in prompt) | 800 | 5 Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ² | 4,000 |
| research_findings (in prompt) | 3,000 | 3 Ğ°Ğ³ĞµĞ½Ñ‚Ğ° | 9,000 |
| build_guidance (in prompt) | 5,000 | 2 Ğ°Ğ³ĞµĞ½Ñ‚Ğ° | 10,000 |
| canonical_snapshot (in prompt) | 8,000 | 2 Ğ°Ğ³ĞµĞ½Ñ‚Ğ° | 16,000 |
| **TOTAL** | | | **61,500** |

**ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ°Ñ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:**
- JSON Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ² Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹ (`${JSON.stringify(run_state)}`)
- Ğ”ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: Ğ¾Ğ´Ğ¸Ğ½ Ğ¸ Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ JSON Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ÑÑ 5 Ñ€Ğ°Ğ·
- Agent files Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‚ Ğ¾Ğ±Ñ‰Ğ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° (L-075 Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ñ„Ğ°Ğ¹Ğ»Ğµ)

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° 4: 250+ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¼ÑƒÑĞ¾Ñ€Ğ°

**Ğ“Ğ´Ğµ:**
- `memory/agent_results/{workflow_id}/` - cycle Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑÑ‚ÑÑ
- `FoodTracker/.n8n/agent_results/` - Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ñ‹ Ğ¸Ğ· ClaudeN8N

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**
```
build_result.json          â† Ğ½ÑƒĞ¶ĞµĞ½
build_result_cycle1.json   â† ĞœĞ£Ğ¡ĞĞ  (Ğ½Ğ¸ĞºÑ‚Ğ¾ Ğ½Ğµ Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚)
build_result_cycle2.json   â† ĞœĞ£Ğ¡ĞĞ 
build_result_cycle3.json   â† ĞœĞ£Ğ¡ĞĞ 
qa_report.json             â† Ğ½ÑƒĞ¶ĞµĞ½
qa_report_cycle1.json      â† ĞœĞ£Ğ¡ĞĞ 
qa_report_cycle2.json      â† ĞœĞ£Ğ¡ĞĞ 
```

---

## Ğ§ĞĞ¡Ğ¢Ğ¬ 3: Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ• (Ğ˜ĞĞ¢Ğ•Ğ“Ğ Ğ˜Ğ ĞĞ’ĞĞĞĞ«Ğ™ ĞŸĞ›ĞĞ)

### ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµĞ¼ 4 Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ°:

1. **MASTER-PLAN-FIX-CONTEXT.md** â†’ 3-level context + ADRs
2. **ORCHESTRATOR-TOKEN-OPTIMIZATION.md** â†’ file-based context
3. **AGENT-PROMPTS-CLEANUP.md** â†’ shared files
4. **ĞŸÑ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ°** â†’ Service Playbooks + Node Intent Cards + Change Protocol

### ĞĞ¾Ğ²Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ğ½ĞµĞ´Ñ€ĞµĞ½Ğ¸Ñ):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTEXT LAYERS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  STRATEGIC (200 tokens)                                     â”‚
â”‚  - 1-STRATEGY.md: Ğ·Ğ°Ñ‡ĞµĞ¼ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚, Ñ†ĞµĞ»Ğ¸, Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹, Ğ¸Ğ½Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ARCHITECTURAL (1500 tokens)                                â”‚
â”‚  - 2-INDEX.md: Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ (ĞºĞ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ)                 â”‚
â”‚  - flow.md: ĞºĞ°Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ´ÑƒÑ‚                                 â”‚
â”‚  - decisions/*.md: ADRs (Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ Ñ‚Ğ°Ğº ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾)                â”‚
â”‚  - services/*.md: Service Playbooks (ğŸ†• NEW!)              â”‚
â”‚  - nodes/*.md: Node Intent Cards (ğŸ†• NEW!)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TACTICAL (500 tokens + lazy load)                          â”‚
â”‚  - state.json: workflow_id, version, node_count             â”‚
â”‚  - Full workflow: load via MCP on demand                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service Playbook (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ¹):

**Ğ—Ğ°Ñ‡ĞµĞ¼:** Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ»Ğ¸ ĞºĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼Ğ¸.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: `architecture/services/telegram.md`**
```markdown
# Telegram Bot API

## ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ FoodTracker Ğ±Ğ¾Ñ‚Ğ°.

## Ğ­Ğ½Ğ´Ğ¿Ğ¾Ğ¹Ğ½Ñ‚Ñ‹
- Webhook: `/webhook/telegram` (POST)
- sendMessage: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²
- Rate limit: 30 msg/sec

## Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ñ‹Ğµ Ğ½Ğ¾Ğ´Ñ‹
- Telegram Trigger (webhook)
- Telegram Send Message (8 Ğ¼ĞµÑÑ‚)
- Switch (Ğ´Ğ»Ñ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´)

## ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°
- âŒ ĞĞ• Ğ¼ĞµĞ½ÑĞ¹ webhook path Ğ±ĞµĞ· Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ BotFather
- âŒ ĞĞ• ÑƒĞ´Ğ°Ğ»ÑĞ¹ Telegram Trigger (Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°)
- âœ… ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ² Switch Ğ”ĞĞ›Ğ–ĞĞ« ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°Ñ‚ÑŒ Ñ BotFather

## Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
- v506: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ»Ğ¸ /welcome Ğ² Switch, Ğ·Ğ°Ğ±Ñ‹Ğ»Ğ¸ Ğ² BotFather â†’ ÑĞ·ĞµÑ€Ñ‹ confused
```

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ»Ñ:** Telegram, Supabase, OpenAI, Whisper (4 Ñ„Ğ°Ğ¹Ğ»Ğ°)

### Node Intent Card (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ¹):

**Ğ—Ğ°Ñ‡ĞµĞ¼:** Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Builder Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ» Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ ĞšĞĞ–Ğ”ĞĞ™ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ğ´Ñ‹.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: `architecture/nodes/ai-agent.md`**
```markdown
# AI Agent Node

## ID
`nodes-base.agent` (ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ² workflow)

## ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº - Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑÑ‚ ÑĞ·ĞµÑ€Ğ°, Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ tools, Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹.

## ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°
**Ğ’Ñ…Ğ¾Ğ´:**
- message: Ñ‚ĞµĞºÑÑ‚ Ğ¾Ñ‚ ÑĞ·ĞµÑ€Ğ°
- context: Ğ´Ğ°Ñ‚Ğ°, timezone, user_id (Ğ¸Ğ· Inject Context)

**Ğ’Ñ‹Ñ…Ğ¾Ğ´:**
- response: Ñ‚ĞµĞºÑÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°
- signature: "-- FoodTracker Bot" (ÑƒĞ±Ğ¸Ñ€Ğ°ĞµÑ‚ÑÑ Strip Signature)

## Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
- âš ï¸ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ: Memory node Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½ (memory_input)
- Inject Context Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ±Ñ‹Ñ‚ÑŒ ĞŸĞ•Ğ Ğ•Ğ” AI Agent
- 16 tools Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹ (Add Meal, Search Meals, etc)

## Ğ˜Ğ½Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ (DO NOT TOUCH!)
1. Memory connection ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ (customKey='telegram_user_id')
2. ĞĞ• Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ jsonBody Ğº tools (v432 Ğ¸Ğ½Ñ†Ğ¸Ğ´ĞµĞ½Ñ‚ - Ğ±Ğ¾Ñ‚ Ğ·Ğ°Ğ¼Ğ¾Ğ»Ñ‡Ğ°Ğ»)
3. Prompt Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ (ÑĞ·ĞµÑ€Ñ‹ Ñ€ÑƒÑÑĞºĞ¾ÑĞ·Ñ‹Ñ‡Ğ½Ñ‹Ğµ)

## ĞŸĞ¾ÑĞ»ĞµĞ´ÑÑ‚Ğ²Ğ¸Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ
ğŸ”´ ĞšĞĞ¢ĞĞ¡Ğ¢Ğ ĞĞ¤Ğ: Ğ‘Ğ¾Ñ‚ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ½ĞµÑ‚ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹, Ğ²ÑĞµ AI Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ ÑĞ»Ğ¾Ğ¼Ğ°ÑÑ‚ÑÑ.

## Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
- v432: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ»Ğ¸ jsonBody â†’ Ğ±Ğ¾Ñ‚ Ğ·Ğ°Ğ¼Ğ¾Ğ»Ñ‡Ğ°Ğ» â†’ Ğ¾Ñ‚ĞºĞ°Ñ‚ v434
- v442: customKey Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¸ â†’ ÑĞµÑÑĞ¸Ğ¸ ÑĞ»Ğ¾Ğ¼Ğ°Ğ»Ğ¸ÑÑŒ â†’ Ğ¾Ñ‚ĞºĞ°Ñ‚ v444
```

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ»Ñ:** AI Agent, Memory, Switch, Inject Context, Telegram Trigger (5-7 Ğ½Ğ¾Ğ´)

### Change Protocol Ğ´Ğ»Ñ Builder (ğŸ†• NEW!):

**Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ (Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹):**
```
Builder:
1. Read workflow (full JSON, 58,000 tokens)
2. Modify nodes directly in memory
3. Write workflow (update_full)
âŒ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ, Ğ½ĞµÑ‚ diff, Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ
```

**ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ (Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹):**
```
Builder:
1. Read workflow (mode=structure, 2,000 tokens)
2. Identify target nodes (Ğ¸Ğ· edit_scope)
3. Read ONLY target nodes (mode=filtered, nodeNames=[...])
4. Generate ChangeSet:
   - what: "Add /water case to Switch"
   - why: "User requested"
   - nodes_affected: ["Switch"]
   - risk: "low"
5. Create diff:
   - added: 1 case in Switch.parameters.rules
   - changed: 0
   - deleted: 0
6. Validate:
   - Graph integrity: âœ…
   - Protected nodes: âœ… (Switch not protected)
   - Breaking changes: âœ… (no deletions)
7. Apply changes (n8n_update_partial_workflow)
8. Log edit_scope: ["Switch"]
âœ… Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Switch Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½, diff Ğ²Ğ¸Ğ´ĞµĞ½, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ
```

### Validators (Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€):

| Validator | ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ | Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ ĞµÑĞ»Ğ¸ |
|-----------|-----------|----------------|
| **Graph Integrity** | ĞĞµÑ‚ Ğ²Ğ¸ÑÑÑ‡Ğ¸Ñ… ÑĞ²ÑĞ·ĞµĞ¹ | nodeId referenced Ğ½Ğ¾ Ğ½Ğµ exists |
| **Required Nodes** | ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ¾Ğ´Ñ‹ Ğ½Ğ° Ğ¼ĞµÑÑ‚Ğµ | Telegram Trigger ÑƒĞ´Ğ°Ğ»ĞµĞ½ |
| **Protected Nodes** | DO NOT TOUCH Ğ½Ğµ Ñ‚Ñ€Ğ¾Ğ½ÑƒÑ‚Ñ‹ | Memory customKey Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ |
| **Breaking Changes** | ĞĞµÑ‚ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ±ĞµĞ· Ğ¾Ğ±Ğ¾ÑĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ | Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ° Ğ½Ğ¾Ğ´Ğ° Ğ¸Ğ· INDEX |
| **Contract Check** | Ğ’Ñ…Ğ¾Ğ´/Ğ²Ñ‹Ñ…Ğ¾Ğ´ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ | AI Agent output Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ |

---

## Ğ§ĞĞ¡Ğ¢Ğ¬ 4: ĞŸĞĞ¨ĞĞ“ĞĞ’ĞĞ¯ Ğ Ğ•ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ (5 Ğ§ĞĞ¡ĞĞ’)

### Ğ¤ĞĞ—Ğ 1: Agent Cleanup + File-based Context (2 Ñ‡Ğ°ÑĞ°)

#### Ğ¨Ğ°Ğ³ 1.1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ shared/ directory (5 Ğ¼Ğ¸Ğ½)
```bash
mkdir -p .claude/agents/shared
mkdir -p .claude/examples
```

#### Ğ¨Ğ°Ğ³ 1.2: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ shared files (20 Ğ¼Ğ¸Ğ½)

**Ğ¤Ğ°Ğ¹Ğ» 1: `.claude/agents/shared/anti-hallucination.md`** (500 tokens)
```markdown
# L-075: Anti-Hallucination Protocol

## STEP 0: MCP Check (MANDATORY!)
Call: mcp__n8n-mcp__n8n_list_workflows limit=1
IF see data â†’ MCP works
IF error â†’ Report, do NOT proceed

## Forbidden
- âŒ Inventing workflow IDs
- âŒ Fake success without MCP response

## Required
- âœ… Log mcp_calls array
- âœ… Quote exact API responses
```

**Ğ¤Ğ°Ğ¹Ğ» 2: `.claude/agents/shared/project-context.md`** (800 tokens)
```markdown
# Project Context Detection

## STEP 0: Read project_path from run_state
project_path=$(jq -r '.project_path' memory/run_state_active.json)

## STEP 1: Load context
1. Read INDEX: {project_path}/.context/2-INDEX.md
2. Read STRATEGY: {project_path}/.context/1-STRATEGY.md

## Priority
1. INDEX (navigation)
2. STRATEGY (mission)
3. flow.md (IF Architect/QA)
4. ADRs (IF Builder changing node)
```

**Ğ¤Ğ°Ğ¹Ğ» 3: `.claude/agents/shared/mcp-tools-status.md`** (200 tokens)
**Ğ¤Ğ°Ğ¹Ğ» 4: `.claude/agents/shared/gates-reference.md`** (300 tokens)

#### Ğ¨Ğ°Ğ³ 1.3: ĞšĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ñ‹Ğ¹ orch.md (30 Ğ¼Ğ¸Ğ½)

**Ğ’Ñ‹Ğ½ĞµÑÑ‚Ğ¸:**
- Changelog â†’ `.claude/CHANGELOG-ORCH.md`
- Examples â†’ `.claude/examples/orch-examples.md`
- Workarounds (ĞµÑĞ»Ğ¸ bugs fixed)

**ĞĞ¾Ğ²Ñ‹Ğ¹ orch.md:** 10,000 â†’ 700 tokens

#### Ğ¨Ğ°Ğ³ 1.4: File-based context (40 Ğ¼Ğ¸Ğ½)

**Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Task calls Ğ² orch.md:**

âŒ **Ğ‘Ğ«Ğ›Ğ:**
```javascript
Task({
  prompt: `## CONTEXT
${JSON.stringify(run_state, null, 2)}  // 800 tokens!
${JSON.stringify(build_guidance, null, 2)}  // 5,000 tokens!
`
})
```

âœ… **Ğ¡Ğ¢ĞĞ›Ğ:**
```javascript
Task({
  prompt: `## CONTEXT FILES
Read these files yourself (in order):
1. run_state: memory/run_state_active.json
2. guidance: memory/agent_results/{workflow_id}/build_guidance.json

Do NOT wait for me to give you content - read files yourself!`
})
```

**Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ:** 18,800 â†’ 200 tokens per agent call

#### Ğ¨Ğ°Ğ³ 1.5: ĞŸĞ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ agent files (60 Ğ¼Ğ¸Ğ½)

**Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ agent/*.md:**
1. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ L-075 section â†’ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° shared/
2. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Project Context â†’ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° shared/
3. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ MCP status â†’ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° shared/
4. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ±Ñ‹Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ â†’ ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° examples/
5. ĞšĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
- builder.md: 2,500 â†’ 900 tokens
- researcher.md: 2,500 â†’ 900 tokens
- qa.md: 2,500 â†’ 900 tokens
- architect.md: 2,000 â†’ 800 tokens
- analyst.md: 2,000 â†’ 800 tokens

**Ğ˜Ğ¢ĞĞ“Ğ Ğ¤ĞĞ—Ğ 1:**
- Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ: 61,500 â†’ 21,400 tokens (65%)
- Ğ’Ñ€ĞµĞ¼Ñ: 2 Ñ‡Ğ°ÑĞ°

---

### Ğ¤ĞĞ—Ğ 2: Context Architecture (1.5 Ñ‡Ğ°ÑĞ°)

#### Ğ¨Ğ°Ğ³ 2.1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ 1-STRATEGY.md Ğ´Ğ»Ñ FoodTracker (10 Ğ¼Ğ¸Ğ½)

**Ğ¤Ğ°Ğ¹Ğ»: `{project}/.context/1-STRATEGY.md`**
```markdown
# FoodTracker - Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ

## Ğ—Ğ°Ñ‡ĞµĞ¼ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚
Telegram Ğ±Ğ¾Ñ‚ Ğ´Ğ»Ñ Ñ‚Ñ€ĞµĞºĞ¸Ğ½Ğ³Ğ° ĞµĞ´Ñ‹ Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€ Ñ AI.

## Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğµ Ñ†ĞµĞ»Ğ¸
1. Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ²Ğ²Ğ¾Ğ´ (Ğ³Ğ¾Ğ»Ğ¾Ñ, Ñ„Ğ¾Ñ‚Ğ¾, Ñ‚ĞµĞºÑÑ‚)
2. Ğ£Ğ¼Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· (AI Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ ĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½ÑƒÑ Ñ€ĞµÑ‡ÑŒ)
3. ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ñ‹ (Ğ´ĞµĞ½ÑŒ, Ğ½ĞµĞ´ĞµĞ»Ñ, Ğ¼ĞµÑÑÑ†)

## Ğ§Ñ‚Ğ¾ ĞĞ• Ğ´ĞµĞ»Ğ°ĞµĞ¼
âŒ ĞĞ• Ñ„Ğ¸Ñ‚Ğ½ĞµÑ-Ñ‚Ñ€ĞµĞºĞµÑ€
âŒ ĞĞ• ĞºĞ½Ğ¸Ğ³Ğ° Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ¾Ğ²
âŒ ĞĞ• Ğ´Ğ»Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

## ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- Ğ‘Ğ¾Ñ‚ Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ <3 ÑĞµĞº
- AI Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ (Memory node)
- ĞÑ‚Ñ‡ĞµÑ‚Ñ‹ Ğ”ĞĞ›Ğ–ĞĞ« Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹
```

#### Ğ¨Ğ°Ğ³ 2.2: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ 2-INDEX.md (15 Ğ¼Ğ¸Ğ½)

**Ğ¤Ğ°Ğ¹Ğ»: `{project}/.context/2-INDEX.md`**
```markdown
# ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ñƒ

## Ğ”Ğ»Ñ Ğ’Ğ¡Ğ•Ğ¥ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²
- ĞŸÑ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ¹: 1-STRATEGY.md

## Ğ”Ğ»Ñ Builder
âš ï¸ ĞŸĞ•Ğ Ğ•Ğ” Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•Ğœ ĞĞĞ”Ğ« - Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ¹ ĞµÑ‘ Intent Card!

| ĞĞ¾Ğ´Ğ° | Intent Card | DO NOT TOUCH |
|------|-------------|--------------|
| AI Agent | nodes/ai-agent.md | Memory connection, jsonBody |
| Memory | nodes/memory.md | customKey='telegram_user_id' |
| Switch | nodes/switch.md | ĞĞ±Ğ½Ğ¾Ğ²Ğ¸ BotFather Ñ‚Ğ¾Ğ¶Ğµ! |

## Protected Nodes (ĞĞ• ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ğ±ĞµĞ· approval!)
- Telegram Trigger (Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ°)
- AI Agent (Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº)
- Memory (Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ğ²)
```

#### Ğ¨Ğ°Ğ³ 2.3: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ flow.md (10 Ğ¼Ğ¸Ğ½)
#### Ğ¨Ğ°Ğ³ 2.4: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ADRs (30 Ğ¼Ğ¸Ğ½)

**3-5 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:**
- 001-ai-agent-memory.md
- 002-inject-context.md
- 003-telegram-sync.md

#### Ğ¨Ğ°Ğ³ 2.5: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Service Playbooks (15 Ğ¼Ğ¸Ğ½)

**2-3 Ñ„Ğ°Ğ¹Ğ»Ğ°:**
- services/telegram.md
- services/supabase.md
- services/openai.md

#### Ğ¨Ğ°Ğ³ 2.6: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Node Intent Cards (20 Ğ¼Ğ¸Ğ½)

**5-7 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:**
- nodes/ai-agent.md
- nodes/memory.md
- nodes/switch.md
- nodes/inject-context.md
- nodes/telegram-trigger.md

**Ğ˜Ğ¢ĞĞ“Ğ Ğ¤ĞĞ—Ğ 2:**
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾: 15 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
- Ğ’Ñ€ĞµĞ¼Ñ: 1.5 Ñ‡Ğ°ÑĞ°

---

### Ğ¤ĞĞ—Ğ 3: Builder Change Protocol (1 Ñ‡Ğ°Ñ)

#### Ğ¨Ğ°Ğ³ 3.1: ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ builder.md - Surgical Edits Protocol (30 Ğ¼Ğ¸Ğ½)

**Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞµĞºÑ†Ğ¸Ñ:**

```markdown
# ğŸ”§ SURGICAL EDITS PROTOCOL (CRITICAL!)

## Rule: Change ONLY what's needed

### âŒ FORBIDDEN (causes breakage):
```javascript
// BAD: Load full workflow
const workflow = await n8n_get_workflow({id, mode: "full"});
// â†’ 58,000 tokens, risky to modify

// Modify multiple nodes
workflow.nodes[5].parameters.x = "new value";
workflow.nodes[12].parameters.y = "other value";

// Write everything back
await n8n_update_full_workflow({id, workflow});
// â†’ High risk: accidental changes to unrelated nodes
```

### âœ… REQUIRED (safe surgical edit):
```javascript
// STEP 1: Read structure only (lightweight)
const structure = await n8n_get_workflow({
  id: workflow_id,
  mode: "structure"  // ~2,000 tokens
});

// STEP 2: Identify target nodes from edit_scope
const targetNodes = qa_report.edit_scope;  // ["Switch", "AI Agent"]

// STEP 3: Read ONLY target nodes
const details = await n8n_get_workflow({
  id: workflow_id,
  mode: "filtered",
  nodeNames: targetNodes
});

// STEP 4: Generate ChangeSet
const changeset = {
  what: "Add /water case to Switch",
  why: "User requested",
  nodes_affected: ["Switch"],
  risk: "low",
  rollback_plan: "Remove case from rules array"
};

// STEP 5: Create diff
const diff = {
  added: ["Switch.parameters.rules[7]"],
  changed: [],
  deleted: []
};

// STEP 6: Validate
if (!validate(diff)) {
  return {error: "Validation failed"};
}

// STEP 7: Apply ONLY to target nodes (partial update)
const result = await n8n_update_partial_workflow({
  id: workflow_id,
  operations: [
    {
      type: "updateNode",
      nodeName: "Switch",
      properties: {
        parameters: updated_parameters
      }
    }
  ]
});

// STEP 8: Log edit_scope
return {
  status: "success",
  edit_scope: ["Switch"],
  diff: diff,
  mcp_calls: [...]
};
```

## When to use partial vs full update

| Scenario | Use | Why |
|----------|-----|-----|
| Modify 1-3 nodes | `n8n_update_partial_workflow` | Safe, surgical |
| Add new node | `n8n_update_partial_workflow` | Isolated change |
| Delete node | `n8n_update_partial_workflow` | Controlled |
| Restructure >50% | `n8n_update_full_workflow` | Major refactor |
| Create from scratch | `n8n_create_workflow` | New workflow |

## Mandatory checks before update

- [ ] Read target node Intent Card
- [ ] Check Protected Nodes list
- [ ] Generate ChangeSet (what, why, risk)
- [ ] Create diff (added, changed, deleted)
- [ ] Validate: graph integrity, contracts
- [ ] Log edit_scope array
- [ ] Use partial update (unless major refactor)
```

#### Ğ¨Ğ°Ğ³ 3.2: ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ QA - Validate Edit Scope (15 Ğ¼Ğ¸Ğ½)

**Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² qa.md:**

```markdown
# Edit Scope Validation

## After Builder update, QA MUST verify:

1. **Read Builder's edit_scope:**
   ```javascript
   const edit_scope = build_result.edit_scope;  // ["Switch", "AI Agent"]
   ```

2. **Get workflow and compare:**
   ```javascript
   const before = previous_version;
   const after = current_version;
   const actual_changes = diff(before, after);
   ```

3. **Verify ONLY edit_scope nodes changed:**
   ```javascript
   const unexpected_changes = actual_changes.filter(
     change => !edit_scope.includes(change.node)
   );

   if (unexpected_changes.length > 0) {
     return {
       status: "FAIL",
       error: "Unexpected changes detected!",
       details: unexpected_changes,
       action: "Rollback and fix Builder"
     };
   }
   ```

4. **Check Protected Nodes:**
   ```javascript
   const protected = ["Telegram Trigger", "AI Agent", "Memory"];
   const touched_protected = actual_changes.filter(
     change => protected.includes(change.node)
   );

   if (touched_protected.length > 0 && !user_approved) {
     return {
       status: "BLOCKED",
       error: "Protected node modified without approval!",
       node: touched_protected[0].node
     };
   }
   ```
```

#### Ğ¨Ğ°Ğ³ 3.3: Enforcement Ğ² Orchestrator (15 Ğ¼Ğ¸Ğ½)

**Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ¿Ğ¾ÑĞ»Ğµ Builder:**

```bash
# After Builder returns
build_result_file="memory/agent_results/${workflow_id}/build_result.json"

# Check edit_scope exists
edit_scope=$(jq -r '.build_result.edit_scope // []' "$build_result_file")
if [ "$edit_scope" = "[]" ]; then
  echo "âš ï¸ WARNING: Builder didn't log edit_scope!"
  echo "Required for surgical edits verification"
fi

# Pass edit_scope to QA
Task({
  prompt: `## ROLE: QA

## TASK: Validate workflow

IMPORTANT: Builder claimed to change only these nodes:
${edit_scope}

Verify ONLY these nodes were actually modified!`
})
```

**Ğ˜Ğ¢ĞĞ“Ğ Ğ¤ĞĞ—Ğ 3:**
- Builder: surgical edits protocol
- QA: edit_scope validation
- Orchestrator: enforcement
- Ğ’Ñ€ĞµĞ¼Ñ: 1 Ñ‡Ğ°Ñ

---

### Ğ¤ĞĞ—Ğ 4: Protected Nodes + Validators (30 Ğ¼Ğ¸Ğ½)

#### Ğ¨Ğ°Ğ³ 4.1: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Protected Nodes Ğ² INDEX (10 Ğ¼Ğ¸Ğ½)

**Ğ’ 2-INDEX.md:**

```markdown
## Protected Nodes (CRITICAL!)

| Node | Why Protected | DO NOT TOUCH | Break if modified |
|------|---------------|--------------|-------------------|
| Telegram Trigger | Entry point | Webhook path | Bot stops receiving messages |
| AI Agent | Core logic | Memory connection, jsonBody | Bot can't process requests |
| Memory | Session state | customKey | Users lose conversation history |
| Switch | Router | Command list | Must update BotFather too |

## Modification Rules

### Protected Node Changes:
1. Read Intent Card FIRST
2. Check DO NOT TOUCH section
3. IF modifying DO NOT TOUCH â†’ get user approval
4. Generate ChangeSet with HIGH risk
5. QA validates extra carefully
```

#### Ğ¨Ğ°Ğ³ 4.2: QA Validators (20 Ğ¼Ğ¸Ğ½)

**Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² qa.md:**

```markdown
# Validators (Mandatory Checks)

## Validator 1: Graph Integrity
```javascript
function validateGraphIntegrity(workflow) {
  const nodeIds = workflow.nodes.map(n => n.id);

  // Check all connections reference existing nodes
  for (const [sourceId, connections] of Object.entries(workflow.connections)) {
    if (!nodeIds.includes(sourceId)) {
      return {valid: false, error: `Connection from non-existent node: ${sourceId}`};
    }

    for (const outputs of Object.values(connections)) {
      for (const conn of outputs) {
        if (!nodeIds.includes(conn.node)) {
          return {valid: false, error: `Connection to non-existent node: ${conn.node}`};
        }
      }
    }
  }

  return {valid: true};
}
```

## Validator 2: Required Nodes
```javascript
function validateRequiredNodes(workflow) {
  const required = ["Telegram Trigger", "AI Agent", "Memory"];
  const existing = workflow.nodes.map(n => n.name);

  const missing = required.filter(r => !existing.includes(r));

  if (missing.length > 0) {
    return {valid: false, error: `Missing required nodes: ${missing.join(', ')}`};
  }

  return {valid: true};
}
```

## Validator 3: Protected Nodes
```javascript
function validateProtectedNodes(before, after, edit_scope) {
  const protected = {
    "Memory": ["parameters.customKey"],
    "AI Agent": ["parameters.tools[].jsonBody"]
  };

  for (const [nodeName, protectedPaths] of Object.entries(protected)) {
    const beforeNode = before.nodes.find(n => n.name === nodeName);
    const afterNode = after.nodes.find(n => n.name === nodeName);

    for (const path of protectedPaths) {
      const beforeValue = getPath(beforeNode, path);
      const afterValue = getPath(afterNode, path);

      if (beforeValue !== afterValue) {
        return {
          valid: false,
          error: `Protected field modified: ${nodeName}.${path}`,
          requires: "USER_APPROVAL"
        };
      }
    }
  }

  return {valid: true};
}
```
```

**Ğ˜Ğ¢ĞĞ“Ğ Ğ¤ĞĞ—Ğ 4:**
- Protected Nodes list
- 3 validators implemented
- Ğ’Ñ€ĞµĞ¼Ñ: 30 Ğ¼Ğ¸Ğ½

---

## Ğ§ĞĞ¡Ğ¢Ğ¬ 5: Ğ§Ğ¢Ğ Ğ˜Ğ—ĞœĞ•ĞĞ˜Ğ¢Ğ¡Ğ¯ (Ğ”Ğ/ĞŸĞĞ¡Ğ›Ğ•)

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 1: Builder Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ½Ğ¾Ğ´Ñƒ

#### âŒ Ğ‘Ğ«Ğ›Ğ (Ğ´Ğ¾ Ğ²Ğ½ĞµĞ´Ñ€ĞµĞ½Ğ¸Ñ):
```
User: "Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /water Ğ² Switch"
  â†“
Orchestrator â†’ Builder
  â†“
Builder:
- Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ²ĞµÑÑŒ workflow (58,000 tokens)
- ĞœĞµĞ½ÑĞµÑ‚ Switch
- Ğ¡Ğ›Ğ£Ğ§ĞĞ™ĞĞ Ğ¼ĞµĞ½ÑĞµÑ‚ parameter Ğ² Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ½Ğ¾Ğ´Ğµ
- update_full_workflow (Ğ²ĞµÑÑŒ workflow)
  â†“
QA: Validation PASS (ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° OK, Ğ½Ğ¾ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ» ÑĞ»Ğ¾Ğ¼Ğ°Ğ½)
  â†“
Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢: /water Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Ğ½Ğ¾ Ñ„Ğ¾Ñ‚Ğ¾-Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞ»Ğ¾Ğ¼Ğ°Ğ»Ğ°ÑÑŒ
User: "Ğ‘Ğ›Ğ¯Ğ”Ğ¬, ĞĞŸĞ¯Ğ¢Ğ¬ Ğ’Ğ¡Ğ Ğ¡Ğ›ĞĞœĞĞ›!"
```

#### âœ… Ğ¡Ğ¢ĞĞ›Ğ (Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ğ½ĞµĞ´Ñ€ĞµĞ½Ğ¸Ñ):
```
User: "Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /water Ğ² Switch"
  â†“
Orchestrator â†’ Builder
  â†“
Builder:
1. Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ INDEX â†’ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ "Switch â†’ nodes/switch.md"
2. Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ nodes/switch.md â†’ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ "DO NOT TOUCH: Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸ BotFather"
3. Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ structure (2,000 tokens)
4. Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ Switch node (100 tokens)
5. Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ChangeSet:
   - what: "Add /water case"
   - why: "User requested"
   - nodes_affected: ["Switch"]
   - risk: "low"
6. Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµÑ‚ diff:
   - added: ["Switch.parameters.rules[7]"]
7. ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ n8n_update_partial_workflow (Ğ¢ĞĞ›Ğ¬ĞšĞ Switch)
8. Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ edit_scope: ["Switch"]
  â†“
QA:
1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ edit_scope: ["Switch"]
2. Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµÑ‚ before/after
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚: Ğ¢ĞĞ›Ğ¬ĞšĞ Switch Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½? âœ…
4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚: Protected nodes Ğ½Ğµ Ñ‚Ñ€Ğ¾Ğ½ÑƒÑ‚Ñ‹? âœ…
5. Validator: graph integrity âœ…
  â†“
Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢: /water Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ½Ğµ Ñ‚Ñ€Ğ¾Ğ½ÑƒÑ‚Ğ¾
User: "ĞĞĞšĞĞĞ•Ğ¦-Ğ¢Ğ Ğ ĞĞ‘ĞĞ¢ĞĞ•Ğ¢!"
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 2: Builder Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞµÑ‚ ÑÑ‚Ğ°Ñ€ÑƒÑ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ

#### âŒ Ğ‘Ğ«Ğ›Ğ:
```
User: "ĞŸĞ¾Ñ‡Ğ¸Ğ½Ğ¸ tool Delete Meal"
  â†“
Builder (Ğ½Ğµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¾ v432):
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ jsonBody Ğº tool
- Ğ‘Ğ¾Ñ‚ Ğ·Ğ°Ğ¼Ğ¾Ğ»Ñ‡Ğ°Ğ» (400 errors)
  â†“
User: "Ğ­Ğ¢Ğ Ğ£Ğ–Ğ• Ğ’ v432 Ğ›ĞĞœĞĞ›Ğ˜!"
```

#### âœ… Ğ¡Ğ¢ĞĞ›Ğ:
```
User: "ĞŸĞ¾Ñ‡Ğ¸Ğ½Ğ¸ tool Delete Meal"
  â†“
Builder:
1. Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ INDEX â†’ "AI Agent â†’ nodes/ai-agent.md"
2. Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ nodes/ai-agent.md:
   ```
   ## DO NOT TOUCH
   ĞĞ• Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ jsonBody Ğº tools

   ## Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
   v432: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ»Ğ¸ jsonBody â†’ Ğ±Ğ¾Ñ‚ Ğ·Ğ°Ğ¼Ğ¾Ğ»Ñ‡Ğ°Ğ» â†’ Ğ¾Ñ‚ĞºĞ°Ñ‚ v434
   ```
3. Builder Ğ²Ğ¸Ğ´Ğ¸Ñ‚ Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ!
4. ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ fix Ğ‘Ğ•Ğ— jsonBody
  â†“
Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢: Tool Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚, Ğ±Ğ¾Ñ‚ Ğ½Ğµ ÑĞ»Ğ¾Ğ¼Ğ°Ğ½
User: "FINALLY!"
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 3: Orchestrator ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‚ tokens

#### âŒ Ğ‘Ğ«Ğ›Ğ:
```
Orchestrator â†’ Builder:
prompt: `
${JSON.stringify(run_state, null, 2)}          // 800 tokens
${JSON.stringify(research_findings, null, 2)}  // 3,000 tokens
${JSON.stringify(build_guidance, null, 2)}     // 5,000 tokens

Build workflow...
`

Ğ˜Ğ¢ĞĞ“Ğ Ğ² Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğµ: 8,800 tokens
```

#### âœ… Ğ¡Ğ¢ĞĞ›Ğ:
```
Orchestrator â†’ Builder:
prompt: `
Read files yourself:
1. memory/run_state_active.json
2. memory/agent_results/{id}/build_guidance.json
3. {project}/.context/2-INDEX.md

Build workflow...
`

Ğ˜Ğ¢ĞĞ“Ğ Ğ² Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğµ: 200 tokens

Builder Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ ÑĞ°Ğ¼: 800 + 2,000 + 300 = 3,100 tokens
(Ñ„Ğ°Ğ¹Ğ»Ñ‹ ĞºÑÑˆĞ¸Ñ€ÑƒÑÑ‚ÑÑ, Ğ½Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‚ÑÑ)

Ğ­ĞšĞĞĞĞœĞ˜Ğ¯: 8,800 â†’ 200 = 97%
```

---

## Ğ§ĞĞ¡Ğ¢Ğ¬ 6: Ğ Ğ˜Ğ¡ĞšĞ˜ Ğ˜ ĞœĞ˜Ğ¢Ğ˜Ğ“ĞĞ¦Ğ˜Ğ¯

### Ğ Ğ¸ÑĞº 1: Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Service Playbooks + Node Intent Cards = 10-15 Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

**ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ:**
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²/Ğ½Ğ¾Ğ´
- Telegram, Supabase, OpenAI, Whisper = 4 Service Playbooks
- AI Agent, Memory, Switch, Inject Context, Trigger = 5 Node Intent Cards
- **Ğ˜Ğ¢ĞĞ“Ğ: 9 Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (Ğ½Ğµ 50!)**

### Ğ Ğ¸ÑĞº 2: ĞĞ³ĞµĞ½Ñ‚Ñ‹ Ğ½Ğµ Ğ±ÑƒĞ´ÑƒÑ‚ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Intent Cards

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Builder Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ

**ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ:**
- GATE Ğ² INDEX: "ĞŸĞ•Ğ Ğ•Ğ” Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•Ğœ ĞĞĞ”Ğ« â†’ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ¹ Intent Card"
- Orchestrator enforcement: Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ‡Ñ‚Ğ¾ Builder Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ»
- QA Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚: Protected fields Ğ½Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¸ÑÑŒ

### Ğ Ğ¸ÑĞº 3: Intent Cards ÑƒÑÑ‚Ğ°Ñ€ĞµÑÑ‚

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞŸĞ¾ÑĞ»Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑÑ‚ÑÑ

**ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ (Ğ¿Ñ€Ğ¾ÑÑ‚Ğ°Ñ, Ğ±ĞµĞ· Ğ°Ğ²Ñ‚Ğ¾-Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸):**
- Analyst Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Intent Cards Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ¿Ğ¾ÑĞ»Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
- User approval: ĞµÑĞ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ñ‚Ñ€Ğ°Ğ³Ğ¸Ğ²Ğ°ĞµÑ‚ DO NOT TOUCH â†’ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºÑƒ

### Ğ Ğ¸ÑĞº 4: Surgical edits ÑĞ»Ğ¾Ğ¼Ğ°ÑÑ‚ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** n8n_update_partial_workflow Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ

**ĞœĞ¸Ñ‚Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ:**
- Fallback: ĞµÑĞ»Ğ¸ partial fails â†’ use full
- QA Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ edit_scope (Ğ´Ğ°Ğ¶Ğµ Ğ¿Ñ€Ğ¸ full update)
- Rollback plan Ğ² ChangeSet

---

## Ğ§ĞĞ¡Ğ¢Ğ¬ 7: ĞœĞ•Ğ¢Ğ Ğ˜ĞšĞ˜ Ğ£Ğ¡ĞŸĞ•Ğ¥Ğ

### Ğ¦ĞµĞ»ĞµĞ²Ñ‹Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸:

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ° | Ğ‘Ğ«Ğ›Ğ | Ğ¦Ğ•Ğ›Ğ¬ | Ğ˜Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ğµ |
|---------|------|------|-----------|
| **Tokens per session** | 61,500 | 21,400 | 65% ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ |
| **Context files** | 250+ | 11 | Ğ§Ğ¸ÑÑ‚Ğ¾Ñ‚Ğ° |
| **Agent prompts** | 21,500 | 7,100 | 67% ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ |
| **Breakage rate** | 30% (3/10 tasks) | 5% (0.5/10) | User frustration |
| **Avg fix time** | 5 hours | 30 min | Efficiency |
| **Builder edit precision** | Full workflow | 1-3 nodes | Surgical |

### ĞšĞ°Ğº Ğ¸Ğ·Ğ¼ĞµÑ€ÑÑ‚ÑŒ:

**ĞŸĞ¾ÑĞ»Ğµ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ÑĞµÑÑĞ¸Ğ¸:**
1. Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ tokens Ğ¿Ğ¾Ñ‚Ñ€Ğ°Ñ‚Ğ¸Ğ»Ğ¸? (Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ <25K)
2. Builder Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ» Ğ¢ĞĞ›Ğ¬ĞšĞ edit_scope? (Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ YES)
3. Ğ§Ñ‚Ğ¾-Ñ‚Ğ¾ ÑĞ»Ğ¾Ğ¼Ğ°Ğ»Ğ¾ÑÑŒ? (Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ NO)
4. Intent Card Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ»Ğ°? (ÑĞ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Builder Ğ² agent_log)

---

## Ğ§ĞĞ¡Ğ¢Ğ¬ 8: ĞŸĞĞ¡Ğ›Ğ•Ğ”ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¬ĞĞĞ¡Ğ¢Ğ¬ Ğ’ĞĞ•Ğ”Ğ Ğ•ĞĞ˜Ğ¯ (Ğ¤Ğ˜ĞĞĞ›)

### ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñ‹ (Ñ‡Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ² Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ):

| ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ | Ğ¤Ğ°Ğ·Ğ° | ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ²Ğ°Ğ¶Ğ½Ğ¾ | Ğ’Ñ€ĞµĞ¼Ñ |
|-----------|------|--------------|-------|
| **P0** | Ğ¤ĞĞ—Ğ 1 (Agent Cleanup) | Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ 65% tokens Ğ½ĞµĞ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ | 2Ñ‡ |
| **P1** | Ğ¤ĞĞ—Ğ 3 (Change Protocol) | ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ¾Ğ¼ĞºĞ¸ | 1Ñ‡ |
| **P2** | Ğ¤ĞĞ—Ğ 2 (Context: ADRs + Node Intent Cards) | ĞĞ³ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ÑÑ‚ Ğ—ĞĞ§Ğ•Ğœ/ĞŸĞĞ§Ğ•ĞœĞ£ | 1.5Ñ‡ |
| **P3** | Ğ¤ĞĞ—Ğ 4 (Validators) | Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° | 30Ğ¼Ğ¸Ğ½ |

### ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ MVP (ĞµÑĞ»Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¼Ğ°Ğ»Ğ¾):

**Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ P0 + P1 = 3 Ñ‡Ğ°ÑĞ°:**
1. Agent Cleanup (file-based context, shared files)
2. Builder Change Protocol (surgical edits, edit_scope)

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ MVP:**
- âœ… 65% ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ tokens
- âœ… Builder Ğ½Ğµ Ğ»Ğ¾Ğ¼Ğ°ĞµÑ‚ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğµ Ğ½Ğ¾Ğ´Ñ‹
- âš ï¸ ĞĞ: Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹ ĞµÑ‰Ğµ Ğ½Ğµ Ğ²Ğ¸Ğ´ÑÑ‚ Intent Cards

### ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ²Ğ½ĞµĞ´Ñ€ĞµĞ½Ğ¸Ğµ (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ğ½Ğ¾):

**P0 + P1 + P2 + P3 = 5 Ñ‡Ğ°ÑĞ¾Ğ²:**
- Ğ’ÑĞµ 4 Ñ„Ğ°Ğ·Ñ‹
- ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»Ğ¾Ğ¼Ğ¾Ğº
- ĞĞ³ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°ÑÑ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚

---

## Ğ¤Ğ˜ĞĞĞ›Ğ¬ĞĞ«Ğ™ Ğ§Ğ•ĞšĞ›Ğ˜Ğ¡Ğ¢

### ĞŸĞµÑ€ĞµĞ´ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾Ğ¼ (Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ°):
- [ ] Ğ‘ÑĞºĞ°Ğ¿ Ğ²ÑĞµÑ… .claude/agents/*.md Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- [ ] Ğ‘ÑĞºĞ°Ğ¿ .claude/commands/orch.md
- [ ] Git commit current state

### Ğ¤ĞĞ—Ğ 1 (2 Ñ‡Ğ°ÑĞ°):
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ .claude/agents/shared/ (4 Ñ„Ğ°Ğ¹Ğ»Ğ°)
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ .claude/examples/
- [ ] ĞšĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ñ‹Ğ¹ orch.md (10K â†’ 700 tokens)
- [ ] File-based context (Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ JSON.stringify Ğ½Ğ° Ğ¿ÑƒÑ‚Ğ¸)
- [ ] ĞŸĞ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ agent/*.md (2500 â†’ 900 tokens ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹)
- [ ] Ğ¢ĞµÑÑ‚: /orch --test agent:builder

### Ğ¤ĞĞ—Ğ 2 (1.5 Ñ‡Ğ°ÑĞ°):
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ {project}/.context/1-STRATEGY.md
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ {project}/.context/2-INDEX.md
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ architecture/flow.md
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ 3 ADRs (001, 002, 003)
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ 3 Service Playbooks (telegram, supabase, openai)
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ 5 Node Intent Cards (ai-agent, memory, switch, inject-context, trigger)

### Ğ¤ĞĞ—Ğ 3 (1 Ñ‡Ğ°Ñ):
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ builder.md: Surgical Edits Protocol
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ qa.md: Edit Scope Validation
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ orch.md: Enforcement Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸
- [ ] Ğ¢ĞµÑÑ‚: /orch ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ workflow, Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ edit_scope

### Ğ¤ĞĞ—Ğ 4 (30 Ğ¼Ğ¸Ğ½):
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Protected Nodes Ğ² 2-INDEX.md
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Validators Ğ² qa.md (3 validator functions)
- [ ] Ğ¢ĞµÑÑ‚: Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ°Ñ‚ÑŒÑÑ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ protected node

### Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚ (15 Ğ¼Ğ¸Ğ½):
- [ ] /orch --test e2e (Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ‚ĞµÑÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)
- [ ] Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°: "Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /test Ğ² FoodTracker"
- [ ] ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ:
  - Builder Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ» Intent Card? âœ…
  - Builder Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ» partial update? âœ…
  - edit_scope Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹? âœ…
  - Validators Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¸? âœ…
  - Tokens < 25K? âœ…

---

## Ğ“ĞĞ¢ĞĞ’ ĞĞĞ§ĞĞ¢Ğ¬?

**Ğ¡ĞºĞ°Ğ¶Ğ¸ "Ğ”Ğ•Ğ›ĞĞ•Ğœ" Ğ¸ Ñ Ğ½Ğ°Ñ‡Ğ½Ñƒ Ñ:**
1. Ğ¤ĞĞ—Ğ 1, Ğ¨Ğ°Ğ³ 1.1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ shared/ directory
2. Ğ—Ğ°Ñ‚ĞµĞ¼ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ²ÑĞµ ÑˆĞ°Ğ³Ğ¸

**Ğ˜Ğ»Ğ¸ ÑĞºĞ°Ğ¶Ğ¸ "Ğ¢ĞĞ›Ğ¬ĞšĞ MVP" Ğ¸ Ñ ÑĞ´ĞµĞ»Ğ°Ñ:**
- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¤ĞĞ—Ğ 1 + Ğ¤ĞĞ—Ğ 3 (3 Ñ‡Ğ°ÑĞ°)
- ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ´Ğ»Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ¿Ğ¾Ğ»Ğ¾Ğ¼Ğ¾Ğº

**Ğ˜Ğ»Ğ¸ Ğ·Ğ°Ğ´Ğ°Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ ĞµÑĞ»Ğ¸ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ½ĞµĞ¿Ğ¾Ğ½ÑÑ‚Ğ½Ğ¾!**
